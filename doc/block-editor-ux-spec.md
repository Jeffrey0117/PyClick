# PyClick 積木編輯器 UX 優化規格

## 版本資訊
- **文件版本**: v1.0
- **撰寫日期**: 2026-01-13
- **目標**: 提升積木編輯器的操作體驗

---

## 1. 現狀分析

### 1.1 目前已有功能
- [x] 積木庫分類顯示（觸發、動作、鍵盤、等待、控制）
- [x] 點擊添加積木到腳本
- [x] 積木參數編輯
- [x] 腳本執行
- [x] 儲存/載入腳本

### 1.2 待改善項目
| 問題 | 影響 |
|------|------|
| 無法拖曳調整積木順序 | 要刪除重建才能調整 |
| 刪除無確認 | 誤刪風險 |
| 參數編輯不直觀 | 要點擊積木才能改 |
| 無法複製積木 | 重複動作要一個個加 |
| 無執行狀態顯示 | 不知道跑到哪了 |

---

## 2. 優化項目

### 2.1 拖曳排序（優先）

**目標**：拖曳積木調整順序

**實作方式**：
```
滑鼠按住積木 → 顯示拖曳預覽 → 放開時插入新位置
```

**視覺效果**：
- 拖曳中：積木半透明跟隨滑鼠
- 目標位置：顯示插入線（藍色橫線）
- 放開：動畫滑入

### 2.2 右鍵選單

**目標**：右鍵積木顯示操作選單

```
┌─────────────┐
│ 📋 複製     │
│ ✂️ 剪下     │
│ 📄 貼上     │
│ ─────────── │
│ ⬆️ 上移     │
│ ⬇️ 下移     │
│ ─────────── │
│ 🗑️ 刪除     │
└─────────────┘
```

### 2.3 刪除確認

**目標**：刪除前確認，避免誤刪

**規則**：
- 單一積木：直接刪除（可 Ctrl+Z 復原）
- 控制積木（含子積木）：彈出確認
- 全部清空：彈出確認

### 2.4 執行狀態顯示

**目標**：執行時高亮當前積木

**視覺效果**：
```
🎬 當按下 [F7] 時          ← 灰色（已執行）
🖱️ 點擊 [button.png]      ← 綠色邊框 + 閃爍（執行中）
⏱️ 等待 [1] 秒             ← 原色（待執行）
```

### 2.5 快捷鍵支援

| 快捷鍵 | 功能 |
|--------|------|
| `Ctrl+S` | 儲存腳本 |
| `Ctrl+Z` | 復原 |
| `Ctrl+Y` | 重做 |
| `Delete` | 刪除選中積木 |
| `Ctrl+C` | 複製 |
| `Ctrl+V` | 貼上 |
| `Ctrl+D` | 複製並貼上（快速複製）|
| `F5` | 執行腳本 |
| `Esc` | 停止執行 |

### 2.6 積木內編輯

**目標**：直接在積木上編輯參數

**現狀**：點擊積木 → 彈出對話框
**優化**：點擊參數區域 → 原地編輯

```
優化前：
┌──────────────────────┐
│ 🖱️ 點擊 [button.png] │  ← 點擊整個積木才能編輯
└──────────────────────┘

優化後：
┌──────────────────────┐
│ 🖱️ 點擊 [button.png▼]│  ← 點擊下拉箭頭直接選擇
└──────────────────────┘
```

---

## 3. 實作順序

### Phase 1: 基礎操作優化
- [ ] 右鍵選單（複製、刪除、上下移動）
- [ ] 刪除確認對話框
- [ ] 快捷鍵支援（Ctrl+S, Delete, F5, Esc）

### Phase 2: 拖曳功能
- [ ] 拖曳排序積木
- [ ] 拖曳視覺效果（半透明、插入線）

### Phase 3: 執行體驗
- [ ] 執行時高亮當前積木
- [ ] 執行進度顯示
- [ ] 錯誤時標記問題積木

### Phase 4: 進階編輯
- [ ] 復原/重做（Undo/Redo）
- [ ] 積木內直接編輯參數
- [ ] 批次選取多個積木

---

## 4. UI 細節

### 4.1 顏色定義
```python
COLORS = {
    "selected": "#FFFFFF33",      # 選中積木的背景
    "hover": "#FFFFFF1A",         # 滑鼠懸停
    "executing": "#4CAF50",       # 執行中邊框
    "executed": "#666666",        # 已執行（變灰）
    "error": "#F44336",           # 錯誤標記
    "insert_line": "#2196F3",     # 拖曳插入線
}
```

### 4.2 動畫時間
```python
ANIMATION = {
    "insert": 150,    # 積木插入動畫 (ms)
    "delete": 100,    # 積木刪除動畫 (ms)
    "highlight": 500, # 執行高亮閃爍週期 (ms)
}
```

---

## 5. 相關檔案

- `block_editor.py` - 積木編輯器主程式
- `doc/block-script-spec.md` - 積木系統原始規格


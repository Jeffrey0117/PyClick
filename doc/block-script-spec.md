# PyClick 積木式腳本系統規格書

## 版本資訊
- **文件版本**: v1.0
- **目標版本**: PyClick 2.1
- **撰寫日期**: 2026-01-12
- **設計理念**: 參考 Scratch 積木式設計，簡單直觀

---

## 1. 設計理念

### 1.1 Scratch 式簡單積木

像 Scratch 一樣，每個動作都是一個**視覺化積木塊**：
- **拖放堆疊**：積木上下堆疊形成腳本
- **顏色分類**：不同類型積木用不同顏色
- **參數內嵌**：參數直接顯示在積木上
- **即拍即用**：截圖後立即可添加動作

### 1.2 核心原則

```
簡單 > 功能
直觀 > 彈性
易學 > 強大
```

---

## 2. 積木分類

### 2.1 動作積木 (藍色 #4C97FF)

| 積木 | 圖示 | 說明 |
|------|------|------|
| **點擊** | 🖱️ 點擊 [圖像▼] | 點擊找到的圖像位置 |
| **右鍵點擊** | 🖱️ 右鍵 [圖像▼] | 右鍵點擊圖像位置 |
| **雙擊** | 🖱️ 雙擊 [圖像▼] | 雙擊圖像位置 |
| **點擊座標** | 🖱️ 點擊 X:[  ] Y:[  ] | 點擊指定座標 |
| **拖曳** | ↔️ 從 [圖像A] 拖到 [圖像B] | 拖曳操作 |
| **滾輪** | 🖲️ 滾動 [上▼] [3] 格 | 滑鼠滾輪 |

### 2.2 鍵盤積木 (綠色 #59C059)

| 積木 | 圖示 | 說明 |
|------|------|------|
| **按鍵** | ⌨️ 按 [Enter▼] | 按下單一按鍵 |
| **組合鍵** | ⌨️ 按 [Ctrl▼]+[C▼] | 組合快捷鍵 |
| **輸入文字** | 📝 輸入 "[      ]" | 打字輸入文字 |

### 2.3 等待積木 (黃色 #FFBF00)

| 積木 | 圖示 | 說明 |
|------|------|------|
| **等待秒數** | ⏱️ 等待 [1] 秒 | 固定時間等待 |
| **等待圖像出現** | 👁️ 等到 [圖像▼] 出現 | 等待目標出現 |
| **等待圖像消失** | 👁️ 等到 [圖像▼] 消失 | 等待目標消失 |

### 2.4 控制積木 (橙色 #FF8C1A)

| 積木 | 圖示 | 說明 |
|------|------|------|
| **重複** | 🔁 重複 [3] 次 { } | 固定次數迴圈 |
| **重複直到** | 🔁 重複直到 [圖像▼] 出現 { } | 條件迴圈 |
| **如果** | ❓ 如果 [圖像▼] 存在 { } | 條件判斷 |
| **如果否則** | ❓ 如果 [圖像▼] 存在 { } 否則 { } | 雙分支判斷 |

### 2.5 觸發積木 (紫色 #9966FF) - 腳本開頭

| 積木 | 圖示 | 說明 |
|------|------|------|
| **當截圖後** | 🎬 當截圖完成時 | 截圖後自動執行 |
| **當按下熱鍵** | 🎬 當按下 [F6▼] 時 | 熱鍵觸發 |
| **當找到圖像** | 🎬 當找到 [圖像▼] 時 | 圖像觸發 |

---

## 3. UI 介面設計

### 3.1 主介面佈局

```
┌─────────────────────────────────────────────────────────────────┐
│ PyClick 腳本編輯器                                    [_][□][X] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐  ┌────────────────────────────────────────┐  │
│  │  📦 積木庫   │  │  📜 腳本區                              │  │
│  │              │  │                                          │  │
│  │  ── 動作 ─── │  │  ┌────────────────────────────────┐    │  │
│  │  🖱️ 點擊     │  │  │ 🎬 當找到 [確認鈕.png▼] 時     │    │  │
│  │  🖱️ 右鍵     │  │  └────────────────────────────────┘    │  │
│  │  🖱️ 雙擊     │  │  ┌────────────────────────────────┐    │  │
│  │  ↔️ 拖曳     │  │  │ 🖱️ 點擊 [確認鈕.png▼]          │    │  │
│  │              │  │  └────────────────────────────────┘    │  │
│  │  ── 鍵盤 ─── │  │  ┌────────────────────────────────┐    │  │
│  │  ⌨️ 按鍵     │  │  │ ⏱️ 等待 [0.5] 秒               │    │  │
│  │  📝 輸入     │  │  └────────────────────────────────┘    │  │
│  │              │  │  ┌────────────────────────────────┐    │  │
│  │  ── 等待 ─── │  │  │ ⌨️ 按 [Enter▼]                 │    │  │
│  │  ⏱️ 等待     │  │  └────────────────────────────────┘    │  │
│  │  👁️ 等到出現 │  │                                          │  │
│  │              │  │       拖曳積木到這裡                    │  │
│  │  ── 控制 ─── │  │                                          │  │
│  │  🔁 重複     │  │                                          │  │
│  │  ❓ 如果     │  │                                          │  │
│  │              │  │                                          │  │
│  └──────────────┘  └────────────────────────────────────────┘  │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│  [▶️ 執行] [⏹️ 停止] [💾 儲存] [📂 載入]    腳本: 未命名.script │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 積木互動方式

**拖放操作**：
- 從積木庫拖曳積木到腳本區
- 積木會自動「吸附」到其他積木
- 拖曳調整積木順序
- 拖出腳本區 = 刪除

**參數編輯**：
- 點擊積木中的 `[下拉▼]` 選擇圖像
- 點擊 `[數字]` 直接輸入
- 點擊 `"文字"` 開啟輸入框

### 3.3 截圖整合流程

```
┌────────────────────────────────────────────┐
│     1. 截圖                                │
│     ↓                                      │
│     2. 框選目標                            │
│     ↓                                      │
│  ┌──────────────────────────────────────┐ │
│  │ 儲存模板後要做什麼？                 │ │
│  │                                      │ │
│  │  [🖱️ 點擊它]  [⏱️ 等它出現]          │ │
│  │                                      │ │
│  │  [📝 編輯腳本]  [❌ 只儲存]           │ │
│  └──────────────────────────────────────┘ │
└────────────────────────────────────────────┘
```

選擇後自動添加對應積木到當前腳本。

---

## 4. 積木視覺設計

### 4.1 積木形狀

```
標準積木（方形帶凹凸）：
    ┌─────────────────────────┐
────┤ 🖱️ 點擊 [確認鈕.png▼]   │
    └─────────────────────────┘────

控制積木（C 形包裹）：
    ┌─────────────────────────┐
────┤ 🔁 重複 [3] 次           │
    │ ┌─────────────────────┐ │
    │ │                     │ │
    │ │  (內部積木放這裡)   │ │
    │ │                     │ │
    │ └─────────────────────┘ │
    └─────────────────────────┘────

觸發積木（帽子形，只能放最上面）：
    ╭─────────────────────────╮
    │ 🎬 當找到 [圖像▼] 時     │
────┴─────────────────────────┴
```

### 4.2 顏色代碼

```css
/* 動作類 - 藍色系 */
.block-action { background: #4C97FF; }

/* 鍵盤類 - 綠色系 */
.block-keyboard { background: #59C059; }

/* 等待類 - 黃色系 */
.block-wait { background: #FFBF00; }

/* 控制類 - 橙色系 */
.block-control { background: #FF8C1A; }

/* 觸發類 - 紫色系 */
.block-trigger { background: #9966FF; }
```

---

## 5. 腳本範例

### 5.1 簡單自動點擊

```
🎬 當找到 [確認按鈕.png] 時
└── 🖱️ 點擊 [確認按鈕.png]
```

### 5.2 連續操作腳本

```
🎬 當按下 [F7] 時
├── 🖱️ 點擊 [開始按鈕.png]
├── ⏱️ 等待 [1] 秒
├── 📝 輸入 "Hello World"
├── ⏱️ 等待 [0.5] 秒
└── ⌨️ 按 [Enter]
```

### 5.3 迴圈腳本

```
🎬 當按下 [F8] 時
└── 🔁 重複 [10] 次
    ├── 🖱️ 點擊 [領獎按鈕.png]
    └── ⏱️ 等待 [2] 秒
```

### 5.4 條件腳本

```
🎬 當找到 [低血量.png] 時
└── ❓ 如果 [藥水.png] 存在
    ├── 是：⌨️ 按 [1]
    └── 否：🖱️ 點擊 [背包.png]
           └── 👁️ 等到 [背包界面.png] 出現
               └── 🖱️ 點擊 [藥水.png]
```

### 5.5 等待出現再點擊

```
🎬 當按下 [F9] 時
├── 👁️ 等到 [登入按鈕.png] 出現
├── 🖱️ 點擊 [登入按鈕.png]
├── ⏱️ 等待 [2] 秒
└── 👁️ 等到 [主畫面.png] 出現
```

---

## 6. 資料結構

### 6.1 腳本 JSON 格式

```json
{
  "name": "自動領獎",
  "version": "1.0",
  "trigger": {
    "type": "hotkey",
    "key": "F8"
  },
  "blocks": [
    {
      "type": "repeat",
      "count": 10,
      "children": [
        {
          "type": "click",
          "target": "領獎按鈕.png"
        },
        {
          "type": "wait",
          "seconds": 2
        }
      ]
    }
  ]
}
```

### 6.2 積木類型定義

```python
BLOCK_TYPES = {
    # 觸發類
    "trigger_hotkey": {
        "category": "trigger",
        "color": "#9966FF",
        "label": "🎬 當按下 [{key}] 時",
        "params": ["key"]
    },
    "trigger_image": {
        "category": "trigger",
        "color": "#9966FF",
        "label": "🎬 當找到 [{image}] 時",
        "params": ["image"]
    },

    # 動作類
    "click": {
        "category": "action",
        "color": "#4C97FF",
        "label": "🖱️ 點擊 [{image}]",
        "params": ["image"]
    },
    "click_xy": {
        "category": "action",
        "color": "#4C97FF",
        "label": "🖱️ 點擊 X:[{x}] Y:[{y}]",
        "params": ["x", "y"]
    },
    "right_click": {
        "category": "action",
        "color": "#4C97FF",
        "label": "🖱️ 右鍵 [{image}]",
        "params": ["image"]
    },
    "double_click": {
        "category": "action",
        "color": "#4C97FF",
        "label": "🖱️ 雙擊 [{image}]",
        "params": ["image"]
    },
    "drag": {
        "category": "action",
        "color": "#4C97FF",
        "label": "↔️ 從 [{from}] 拖到 [{to}]",
        "params": ["from", "to"]
    },
    "scroll": {
        "category": "action",
        "color": "#4C97FF",
        "label": "🖲️ 滾動 [{direction}] [{amount}] 格",
        "params": ["direction", "amount"]
    },

    # 鍵盤類
    "press_key": {
        "category": "keyboard",
        "color": "#59C059",
        "label": "⌨️ 按 [{key}]",
        "params": ["key"]
    },
    "hotkey": {
        "category": "keyboard",
        "color": "#59C059",
        "label": "⌨️ 按 [{modifier}]+[{key}]",
        "params": ["modifier", "key"]
    },
    "type_text": {
        "category": "keyboard",
        "color": "#59C059",
        "label": "📝 輸入 \"{text}\"",
        "params": ["text"]
    },

    # 等待類
    "wait": {
        "category": "wait",
        "color": "#FFBF00",
        "label": "⏱️ 等待 [{seconds}] 秒",
        "params": ["seconds"]
    },
    "wait_image": {
        "category": "wait",
        "color": "#FFBF00",
        "label": "👁️ 等到 [{image}] 出現",
        "params": ["image"]
    },
    "wait_image_gone": {
        "category": "wait",
        "color": "#FFBF00",
        "label": "👁️ 等到 [{image}] 消失",
        "params": ["image"]
    },

    # 控制類
    "repeat": {
        "category": "control",
        "color": "#FF8C1A",
        "label": "🔁 重複 [{count}] 次",
        "params": ["count"],
        "has_children": True
    },
    "repeat_until": {
        "category": "control",
        "color": "#FF8C1A",
        "label": "🔁 重複直到 [{image}] 出現",
        "params": ["image"],
        "has_children": True
    },
    "if_image": {
        "category": "control",
        "color": "#FF8C1A",
        "label": "❓ 如果 [{image}] 存在",
        "params": ["image"],
        "has_children": True,
        "has_else": False
    },
    "if_else": {
        "category": "control",
        "color": "#FF8C1A",
        "label": "❓ 如果 [{image}] 存在 ... 否則",
        "params": ["image"],
        "has_children": True,
        "has_else": True
    }
}
```

---

## 7. 檔案結構

```
pyclick/
├── tray_clicker.py          # 主程式
├── block_editor.py          # 積木編輯器模組 (新增)
├── block_runner.py          # 腳本執行引擎 (新增)
│
├── scripts/                 # 腳本儲存目錄 (新增)
│   ├── auto_click.json
│   └── ...
│
├── templates/               # 圖像模板
│   └── ...
│
└── doc/
    ├── macro-system-spec.md
    └── block-script-spec.md # 本文件
```

---

## 8. 實作階段

### 第一階段：基礎積木系統 (MVP)

**目標**：可以拖放積木、執行簡單腳本

| # | 任務 | 說明 |
|---|------|------|
| 1 | 積木資料結構 | Block 類別、腳本 JSON 格式 |
| 2 | 積木庫 UI | 左側積木分類列表 |
| 3 | 腳本區 UI | 右側拖放堆疊區域 |
| 4 | 拖放功能 | Tkinter DnD 實作 |
| 5 | 基礎積木 | click, wait, press_key, type_text |
| 6 | 腳本執行 | 順序執行積木動作 |
| 7 | 儲存/載入 | JSON 讀寫腳本 |

### 第二階段：完整積木集

| # | 任務 | 說明 |
|---|------|------|
| 8 | 觸發積木 | trigger_hotkey, trigger_image |
| 9 | 控制積木 | repeat, if_image |
| 10 | 等待積木 | wait_image, wait_image_gone |
| 11 | 進階動作 | drag, scroll, double_click, right_click |
| 12 | C形積木 | 控制積木的巢狀結構 UI |

### 第三階段：整合與優化

| # | 任務 | 說明 |
|---|------|------|
| 13 | 截圖整合 | 截圖後快速添加積木 |
| 14 | 主程式整合 | 與 tray_clicker.py 整合 |
| 15 | 腳本管理 | 列表、重命名、刪除 |
| 16 | 執行狀態 | 高亮當前執行積木 |
| 17 | 錯誤處理 | 找不到圖像時的處理 |

---

## 9. 與現有系統的整合

### 9.1 截圖後的快速選單

修改 `tray_clicker.py` 的「儲存選取」流程：

```python
def on_save_template(self):
    # 原有儲存邏輯...

    # 新增：顯示快速選單
    self.show_quick_action_menu()

def show_quick_action_menu(self):
    """顯示截圖後的快速動作選單"""
    menu = QuickActionMenu(self.root)
    result = menu.show()

    if result == "click":
        # 在當前腳本添加點擊積木
        self.block_editor.add_block("click", image=self.last_template)
    elif result == "wait":
        # 添加等待出現積木
        self.block_editor.add_block("wait_image", image=self.last_template)
    elif result == "edit":
        # 開啟積木編輯器
        self.open_block_editor()
```

### 9.2 現有功能保持不變

- 原有的「自動模式」繼續運作
- 原有的「熱鍵模式」繼續運作
- 積木腳本是額外的進階功能
- 使用者可以選擇簡單模式或腳本模式

---

## 10. 未來擴展

### 10.1 潛在新增積木

```
📋 複製          # 複製選取的文字
📋 貼上          # 貼上剪貼簿內容
📸 截圖儲存      # 截取指定區域並儲存
🔊 播放聲音      # 執行時播放提示音
💬 顯示通知      # 顯示系統通知
🔢 變數設定      # 設定變數值
🔢 變數修改      # 增減變數值
```

### 10.2 分享功能

- 匯出腳本為 `.pyclick` 檔案
- 匯入其他人分享的腳本
- 自動打包所需的圖像模板

---

## 附錄：Scratch vs PyClick 對照

| Scratch 積木 | PyClick 對應 |
|-------------|--------------|
| 當綠旗被點擊 | 🎬 當按下熱鍵時 |
| 移動 10 步 | 🖱️ 點擊座標 |
| 等待 1 秒 | ⏱️ 等待 1 秒 |
| 重複 10 次 | 🔁 重複 10 次 |
| 如果...那麼 | ❓ 如果圖像存在 |
| 碰到邊緣就反彈 | 👁️ 等到圖像出現 |
| 說「Hello」 | 📝 輸入 "Hello" |
